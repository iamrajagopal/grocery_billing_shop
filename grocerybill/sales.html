<!DOCTYPE html>
<html>
    <head>
        <title>Sales - Grocery Shop</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <style>
            body { font-family: Arial, sans-serif; background: #f9fafb; margin: 0; padding: 20px; }
            h1 { color: #1a7bbd; text-align: center; margin-bottom: 20px; }
            table { border-collapse: collapse; width: 90%; max-width: 900px; margin: auto; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 16px rgba(0,0,0,0.1); }
            th, td { padding: 14px 20px; text-align: left; border-bottom: 1px solid #eee; }
            th { background-color: #1a7bbd; color: white; }
            tr:hover { background-color: #f1f5fb; }
            @media (max-width: 600px) {
                table, thead, tbody, th, td, tr { display: block; }
                th { position: sticky; top: 0; }
                td { padding-left: 50%; position: relative; }
                td::before { position: absolute; top: 14px; left: 14px; width: 45%; white-space: nowrap; font-weight: bold; }
                td:nth-of-type(1)::before { content: "Product"; }
                td:nth-of-type(2)::before { content: "Quantity"; }
                td:nth-of-type(3)::before { content: "Total Price"; }
                td:nth-of-type(4)::before { content: "Date"; }
            }
            .back-link {
            display: inline-block;
            margin: 15px 20px 10px;
            padding: 8px 14px;
            background-color: #8592b4;
            color: white;
            text-decoration: none;
            font-weight: 600;
            border-radius: 6px;
            box-shadow: 0 2px 6px rgba(0, 123, 255, 0.4);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        .back-link:hover {
            background-color: #0056b3;
            box-shadow: 0 4px 12px rgba(0, 86, 179, 0.6);
            text-decoration: none;
        }
        </style>
    </head>
    <body>
        <a href="/profile" class="back-link">&#8592; Back to Dashboard</a>

        <h1>Sales History</h1>
        <table id="salesTable">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Quantity</th>
                    <th>Total Price ($)</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                <tr><td colspan="4" style="text-align:center;">Loading sales...</td></tr>
            </tbody>
        </table>
        <script>
            async function loadSales() {
                try {
                    const token = localStorage.getItem("access_token");
                    const resp = await fetch('/api/sales', {
                        headers: { "Authorization": "Bearer " + token }
                    });
                    if (!resp.ok) throw new Error("Failed to fetch sales");
                    const sales = await resp.json();

                    const tbody = document.querySelector("#salesTable tbody");
                    tbody.innerHTML = "";

                    sales.forEach(sale => {
                        const tr = document.createElement("tr");
                        tr.innerHTML = `
                            <td>${sale.product_name}</td>
                            <td>${sale.quantity}</td>
                            <td>${sale.total_price.toFixed(2)}</td>
                            <td>${new Date(sale.sale_date).toLocaleString()}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                } catch (err) {
                    console.error("Failed to load sales:", err);
                    const tbody = document.querySelector("#salesTable tbody");
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; color: red;">Failed to load sales data. Please login.</td></tr>';
                }
            }
            loadSales();
        </script>
    </body>
    </html>
